<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-gb">



<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">

<title>VTCaster - VisionTech Limited</title>
<meta name="keywords" content="dynamic,cast,custom interace,COM,visual basic,ATL,visual c++,script,Implements,QueryInterface">
<meta name="description" content="Dynamically cast objects so that you can use custom interfaces in script.">

<link rel="stylesheet" type="text/css" href="../style/style.css">
<meta name="revisit-after" content="1 days">
<meta name="robots" content="all">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../rss/rss.aspx">
</head>

<body>
<div id="branding"></div>
<div id="logo"></div>
<div id="menu"></div>

<div id="bodycontent">

<H1>Dynamically cast interfaces in script</H1>

<P>Recently someone asked in one of the VB newsgroups <EM>"Can scripting code create
a component interface that is part of a custom interface?"</EM>.</P>

<P>My initial reaction was that no, you couldn't do this because scripting uses
the IDispatch interface and you can only have one on your component. However,
Sanin Saracevic put me right and pointed out that scripting can
automatically wrap custom interfaces for you if you provide a method in your
class to give you the custom interface. He also suggested writing a C++ component
to read the component type library and dynamically cast the object to the required
interface. This is what VTCaster does.</P>

<P>Okay, so that sounds a bit complicated; here's an example to help you see how
it works.</P>

<P>Suppose I create a class file (<EM>MyIface.cls</EM>) in VB to define an interface I want to implement
(note that there is no function body - this is just the interface):</P>

<P><TT>
Option Explicit<BR>
Public Function MyTest() As String<BR>
End Function
</TT></P>

<P>Now, I create another class (<EM>Test.cls</EM>), which will implement
the <TT>MyIface</TT> interface (and also a Test() method).</P>

<P><TT>
Option Explicit<BR>
Implements MyIface<BR>
<BR>
Public Function Test() As String<BR>
&nbsp;&nbsp;&nbsp;&nbsp;Test = "Test function"<BR>
End Function<BR>
<BR>
Private Function MyIface_MyTest() As String<BR>
&nbsp;&nbsp;&nbsp;&nbsp;MyIface_MyTest = "Interface MyTest"<BR>
End Function<BR>
</TT></P>

<P>Now in my .VBS script file, or .ASP web page, I can use the following
code:</P>

<P><TT>
Dim oTest,oIface,oCast,strTemp<BR><BR>
Set oTest = CreateObject("Project.Test")<BR>
strTemp = oTest.Test ' strTemp now holds "Test function"<BR><BR>
Set oCast = CreateObject("VTCaster.DynCast")<BR>
Set oIface = oCast.castToInterface(oTest,"_MyIface")<BR>
strTemp = oIface.MyTest ' strTemp now holds "Interface MyTest"<BR>
</TT></P>

<P>The <TT>castToInterface</TT> call allows you to pass an object, and the name
of the required interface, and it returns this interface. VB usually prepends an
underscore (_) to the beginning of interface names which is why the code above asks
for the <TT>"_MyIface"</TT> interface). In ASP code, you would typically use
<TT>Server.CreateObject</TT> rather than simply <TT>CreateObject</TT>.</P>

<P>You can <A HREF="download/VTCaster.zip">download the source code</A> for VTCaster [43K].
The zip file also includes a compiled DLL in case you don't have access to Visual C++.
Don't forget to register the DLL with <TT>regsvr32</TT> before you try to use it.</P>

	</div>

<div id="leftcontent">&nbsp;</div>

</body>



</html>